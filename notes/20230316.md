# Poznatky 16.03.2023

- mám připravený build linuxu bez interruptu na GPIO
- připravený build mymodule_edited z YT návodu
- připravený build kernel modulu ohledně zápisu do device

- zjistit, zda aby šel interrupt pověsit dle YT je třeba aby byl na GPIO pověšený interrupt v HDF a nebo ne
- zjistit zápis do /dev, zda to funguje
- vyřešit, jakou variantu akvizice dat dělat a podle toho se přizpůsobit - zeptat se vedoucího na jeho názor

  - multi threading, second thread just while loop and mutexes
  - multi threading with future, wait for data acquisition - blocking of main program
  - kernel loadable module - it is more hardcore, but has higher priority than user program

- momentálně zkouším v device tree bez GPIO interruptů a v HDF bez interruptu do GPIO s [mymodule_edited.c](./code/20230314/mymodule_edited.c), které by se mělo pověsit na interrupt, asi to nepůjde, taky vyzkoušet modul z tutoriálu na vytvoření device = **TAK TO NEJDE SE POVĚSIT, POVĚŠOVALO BY SE TO NA INTERRUPT S ID (-6)**, zkusím ještě dát interrupt do device tree a ne do BD

  - ukázka hlášky
    ![Hláška](./images/20230316/20230316_gpio_kernel_module_without_bd_without_dt.png)

- když se spustí tutorial kernel module a zapíše se pomocí `echo test > /dev/deviceName`, dojde k chybě v linuxu... proto chci vyzkoušet psát z userspace programu, protože jinak kernel modul vypadá, že funguje, prootože dostal i major number atd.

- zkusil jsem vykompilovat pomocí GCC test z internetu ale samozřejmě to nejde, protože to není cross kompilace, takže musím udělat --sdk a zkusit basic testovací program na `petalinux-no-rt-same-hw` s modulem `tutorial` pro zápis do device, abych mohl řešit algoritmus akvizice dat

  - asi je chyba v tutoriálu, že místo `spritf` má být použito `copy_from_user(message,buffer,len);`

  - protože je v plánu, že v kernelu bude spouštěn PL timer (nebo SW kernel timer) a po vyhození interruptu dojde k sejmutí hodnot z „čidla“ a vložení hodnoty do `/dev/deviceName`, ze které si to bude brát userspace aplikace

- pokud to nepůjde, v BD ve vivado přidat z GPIO do interruptu vstup a vybuildit linux a zkusit zase my module

## DO DPT.TEX

- popsat, že se lyší zybo a kria v BOOT managingu, že to není už monolitické a není to fixnuté tak, že když se dělíá aplikace, že se vygenereuje celý set těchto dat, ale že se vytvoří jako na platformu a BOOT.bin se dá do jedné části bootovací sekvence a zbytek do druhé, že je increment approach atd... popis zde: [https://xilinx.github.io/kria-apps-docs/creating_applications/2022.1/build/html/docs/bitstream_management.html](https://xilinx.github.io/kria-apps-docs/creating_applications/2022.1/build/html/docs/bitstream_management.html)
