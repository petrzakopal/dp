# Poznatky 29.10.2022

## Obecné poznámky

- snažím se rozchodit build na serveru a poté přenést na SD kartu a flashnout
- build je náročný i pro 20 jádrový server
- magisterský projekt má již název
- server je možné managovat pomocí proxmox - mám veřejnou ip adresu, je možné pracovat na DP odkudkoliv, když je server zapnutý
- rozchodil jsem linux kde je vector addition ale nejde spustit, protože soubory nejso vidět, protože už používám rozdělené partition
- nelze vidět ani USB - nebylo nainstalováno, zkouším přidat do souboru `xilix-workspace/zybo-petalinux/project-spec/meta-user/recipes-bsp/device/tree/files/system-user.dtsi`

```
/include/ "system-conf.dtsi"
#include <dt-bindings/gpio/gpio.h>

/ {
	model = "Zynq Zybo Development Board";
	compatible = "digilent,zynq-zybo", "xlnx,zynq-7000";

	chosen {
		bootargs = "console=ttyPS0,115200 earlyprintk uio_pdrv_genirq.of_id=generic-uio";
	};

	usb_phy0: usb_phy@0 {
		compatible = "ulpi-phy";
		#phy-cells = <0>;
		reg = <0xe0002000 0x1000>;
		view-port = <0x0170>;
		drv-vbus;
	};


};

&gem0 {
	phy-handle = <&ethernet_phy>;
/*	phy-reset-gpio = <&axi_gpio_eth 0 0>;
	phy-reset-active-low;
	phy-reset-duration = <10>; */
	ethernet_phy: ethernet-phy@1 { /* rtl8211e-vl */
		reg = <1>;
		device_type = "ethernet-phy";
	};
};

&usb0 {
	usb-phy = <&usb_phy0>;
	dr_mode = "host";
};
&sdhci0 {
	u-boot,dm-pre-reloc;
};
&uart1 {
	u-boot,dm-pre-reloc;
};

&qspi {
	u-boot,dm-pre-reloc;
};
&flash0 {
	compatible = "micron,m25p80", "s25fl128s", "spi-flash";
};



&amba_pl {
	encoder_0: digilent_encoder {
		compatible = "digilent,drm-encoder";
		digilent,fmax = <150000>;
		digilent,edid-i2c = <&i2c1>;
	};

	xilinx_drm {
		compatible = "xlnx,drm";
		xlnx,vtc = <&v_tc_out>;
		xlnx,connector-type = "HDMIA";
		xlnx,encoder-slave = <&encoder_0>;
		clocks = <&axi_dynclk_0>;
		planes {
			xlnx,pixel-format = "rgb888";
			plane0 {
				dmas = <&axi_vdma_0 0>;
				dma-names = "dma0";
			};
		};
	};
};
&axi_dynclk_0 {
	compatible = "digilent,axi-dynclk";
	#clock-cells = <0>;
	clocks = <&clkc 15>;
};
&axi_vdma_0 {
	dma-ranges = <0x00000000 0x00000000 0x40000000>;
};
&v_tc_out {
	compatible = "xlnx,v-tc-5.01.a";
};

&axi_gpio_hdmi {
	compatible = "generic-uio";
};


&amba_pl {
	i2s_clk: i2s_clk {
		#clock-cells = <0>;
		compatible = "fixed-clock";
		clock-frequency = <12228000>;
		clock-output-names = "i2s_clk";
	};

	sound {
		compatible = "simple-audio-card";
		simple-audio-card,name = "Zybo-Sound-Card";
		simple-audio-card,format = "i2s";
		simple-audio-card,bitclock-master = <&dailink0_master>;
		simple-audio-card,frame-master = <&dailink0_master>;
		simple-audio-card,widgets =
			"Microphone", "Microphone Jack",
			"Headphone", "Headphone Jack",
			"Line", "Line In Jack";
		simple-audio-card,routing =
			"MICIN", "Microphone Jack",
			"Headphone Jack", "LHPOUT",
			"Headphone Jack", "RHPOUT",
			"LLINEIN", "Line In Jack",
			"RLINEIN", "Line In Jack";
		dailink0_master: simple-audio-card,cpu {
			clocks = <&i2s_clk>;
			sound-dai = <&axi_i2s_adi_0>;
		};
		simple-audio-card,codec {
			clocks = <&i2s_clk>;
			sound-dai = <&ssm2603>;
		};
	};
};
&axi_i2s_adi_0 {
	#sound-dai-cells = <0>;
	compatible = "adi,axi-i2s-1.00.a";
	clocks = <&clkc 15>, <&i2s_clk>;
	clock-names = "axi", "ref";
	dmas = <&dmac_s 0 &dmac_s 1>;
	dma-names = "tx", "rx";
};
&i2c0 {
	ssm2603: ssm2603@1a{
		#sound-dai-cells = <0>;
		compatible = "adi,ssm2603";
		reg = <0x1a>;
	};

	eeprom@50 {
		/* Microchip 24AA02E48 */
		compatible = "microchip,24c02";
		reg = <0x50>;
	};
};

&axi_gpio_led {
	compatible = "generic-uio";
};


&axi_gpio_sw_btn {
	compatible = "generic-uio";
};
```

- zkontroloval jsem i podle návodu co někdo kontroloval [xilinx](https://support.xilinx.com/s/question/0D52E00006hpbh0SAA/usb-host-not-working-on-digilent-zybo?language=en_US), že je použito USB - mělo by tedy vždy tohle být zařízené v závislosti na bsp file nebo jak se to jmenuje - prostě board_files
- zkouším buildit a přidal jsem další package
  - šlo `petalinux-build` ale až po udělání nového petalinux projektu, jinak to házelo chybu
  - `zkouším petalinux-build --sdk`

![Checked USB](/notes/images/20221029/checked-usb.png)

**Možnosti využití FPGA pro řízení pohonů**

popis: _Prostudujte možnosti využití ZYBO 7000 pro řízení elektrických pohonů._

literatura: _tutoriály Xiinx_

![Náročný build ve Vitis](/misc/narocny-build.png)

## Working on

_příprava struktury textové práce_

- Úvod
  - Motivace
  - Cíle diplomové práce
- Teoretický základ
  - Application specified HW/SW / Hardware accelerated applications
  - FPGA obecně
    - Jak fungují
    - Jak se programují
    - Proč se používají
    - Aplikace v elektrických pohonech
  - Vývojová deska Digilent Zybo
    - Z čeho se skládá
    - Jeho omezení
    - Možnosti nahrazení (již není dostupné)
  - Matematický model stroje
- Program pro FPGA/CPU
  - Použité nástroje
  - Tvorba HW architektury Xilinx Vivado
  - Tvorba SW pro CPU/FPGA
  - Workflow práce s Digilent Zybo + Petalinux + Embeded Accelerated Applications
  - Set Up práce

### Externí zdroje

- [O FPGA obecně](https://ieeexplore-ieee-org.ezproxy.techlib.cz/document/4267891)
- [Řízení power converters FPGA](https://ieeexplore-ieee-org.ezproxy.techlib.cz/document/4663812)
- FPGAs Fundamentals, advanced features, and applications in industrial electronics
- Digital System Design with FPGA Implementation Using Verilog and VHDL
- Beginning FPGA* Programming Metal* Your brain on hardware
- Verilog HDL A Guide to Digital Design and Synthesis
- FPGAs for Software Programmers
- Embedded Systems Design with Platform FPGAs Principles and Practices
- High-Performance Computing Using FPGAs
- Principles and Structures of FPGAs

### Vendor zdroje

- [Digilent Docs](https://digilent.com/reference/programmable-logic/zybo-z7/reference-manual?redirect=1)
- DEPRACATED but still used by PZ development kit [Docs](https://digilent.com/reference/programmable-logic/zybo/start?redirect=1)
- informace o programování kernelů (pro FPGA) accelerated applications [Xilix](https://docs.xilinx.com/r/en-US/ug1393-vitis-application-acceleration/A-Sample-Application)
- jak optimalizovat programy v HLS [Xilix](https://docs.xilinx.com/r/en-US/ug1399-vitis-hls/Getting-Started-with-Vitis-HLS); _je tam dobrý checklist optimalizace_
- co znamená port v PRAGMA [Xilinx](https://docs.xilinx.com/r/en-US/ug1399-vitis-hls/pragma-HLS-interface)
- na odkaze [Support Xilinx](https://support.xilinx.com/s/article/73686?language=en_US) je možné dole stáhnout xlsx soubor, který obsahuje skript na nainstalování potřebných knihoven do Linuxu

### Návody

- možná návod jak udělat Linux a Accelerated App [Hackster.io](https://www.hackster.io/mohammad-hosseinabady2/vitis-2021-1-embedded-platform-for-zybo-z7-20-d39e1a)
